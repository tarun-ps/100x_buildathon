<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG Animation to Video</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    canvas {
      border: 1px solid black;
      margin-bottom: 20px;
    }
    button {
      font-size: 16px;
      padding: 10px 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Canvas for Rendering -->
  <canvas id="canvas" width="500" height="500"></canvas>
  <!-- Button -->
  <button id="start-capture">Start Capture</button>

  <!-- SVG Animation (Hidden) -->
  <svg id="animated-svg" xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500" style="display: none;">
    <defs>
      <mask id="reveal-mask">
        <rect x="0" y="0" width="500" height="500" fill="white" />
        <circle id="mask-circle" cx="250" cy="250" r="0" fill="black" />
      </mask>
    </defs>
    <rect x="0" y="0" width="500" height="500" fill="blue" />
    <text x="50" y="250" font-size="60" fill="white" mask="url(#reveal-mask)">SVG Mask Animation</text>
  </svg>

  <!-- Include CCapture.js -->
  <script src="https://cdn.jsdelivr.net/npm/ccapture.js-npmfixed@1.1.0/build/CCapture.all.min.js"></script>
  <script>
    const svg = document.getElementById('animated-svg');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const startButton = document.getElementById('start-capture');

    const img = new Image();

    startButton.addEventListener('click', () => {
      const maskCircle = svg.querySelector('#mask-circle');
      let frameCount = 0;
      const totalFrames = 60; // 2 seconds at 30 FPS
      const framerate = 30;

      // Initialize CCapture
      const capture = new CCapture({
        format: 'webm',
        framerate: framerate,
        verbose: true,
      });

      // Start capturing
      capture.start();

      const animate = () => {
        if (frameCount < totalFrames) {
          const progress = frameCount / totalFrames; // Calculate progress (0 to 1)
          const radius = progress * 300; // Animate radius from 0 to 300
          maskCircle.setAttribute('r', radius); // Update the circle radius

          // Serialize the updated SVG and redraw it
          const svgURL = new XMLSerializer().serializeToString(svg);
          img.src = 'data:image/svg+xml;base64,' + btoa(svgURL);

          img.onload = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height); // Draw updated SVG

            // Capture the canvas frame
            capture.capture(canvas);
          };

          frameCount++;
          requestAnimationFrame(animate); // Schedule the next frame
        } else {
          // Stop capturing and save the video
          capture.stop();
          capture.save();
        }
      };

      animate(); // Start the animation
    });
  </script>
</body>
</html>
